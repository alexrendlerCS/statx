<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Search NFL player stats including rushing yards, touchdowns, and more.">
    <title>Player Stats Search</title>
    <link href="./style.css" rel="stylesheet">
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }
      tr:nth-child(even) {
        background-color: #f9f9f9;
      }
      tr:hover {
        background-color: #f1f1f1;
      }
      .loading {
        text-align: center;
        color: #666;
        margin-top: 20px;
      }
      .error {
        text-align: center;
        color: red;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <!-- Header Section -->
    <header>
      <div class="logo">
        <h1>Stats X</h1>
      </div>
      <!-- Navigation Bar -->
      <nav>
        <a href="index.html">Home</a>
        <a href="defenseStats.html">Defense v.s. Position</a>
        <a href="playerStats.html">Player Stats</a>
      </nav>
    </header>

    <div class="right_col" role="main" style="margin-bottom: 500px">
      <div class="container">
        <h1>NFL Player Stats Search</h1>
        <form id="playerSearchForm">
          <label for="playerName">Enter NFL Player Name (e.g., Saquon Barkley):</label>
          <input type="text" id="playerName" name="playerName" required>
          <button type="submit">Search</button>
        </form>

        <div id="statsContainer">
          <!-- The stats data will be displayed here -->
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <footer>
      <p>&copy; 2024 Stats X. All rights reserved.</p>
    </footer>

    <script>
      const form = document.getElementById('playerSearchForm');
      const statsContainer = document.getElementById('statsContainer');
      const cache = {}; // Simple caching mechanism for repeated queries

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const playerName = document.getElementById('playerName').value.trim();

        if (!playerName) {
          statsContainer.innerHTML = '<p class="error">Please enter a player name.</p>';
          return;
        }

        // Check cache
        if (cache[playerName]) {
          statsContainer.innerHTML = cache[playerName];
          return;
        }

        statsContainer.innerHTML = '<p class="loading">Loading stats...</p>';

        try {
          const response = await fetch(
            `https://api.statsx.online/api/get-player-stats?player_name=${encodeURIComponent(playerName)}`
          );

          if (!response.ok) {
            throw new Error('Failed to fetch stats. Please try again.');
          }

          const data = await response.json();

          if (data.error) {
            statsContainer.innerHTML = `<p class="error">${data.error}</p>`;
            return;
          }

          // Generate the table
          let tableHtml = `
            <table>
              <thead>
                <tr>
                  <th>Week</th>
                  <th>Team</th>
                  <th>Position</th>
                  <th>Rushing Attempts</th>
                  <th>Rushing Yards</th>
                  <th>Rushing TDs</th>
                  <th>Receptions</th>
                  <th>Receiving Yards</th>
                  <th>Receiving TDs</th>
                </tr>
              </thead>
              <tbody>
          `;

          data.forEach((stat) => {
            tableHtml += `
              <tr>
                <td>${stat.week}</td>
                <td>${stat.team_id}</td>
                <td>${stat.position_id}</td>
                <td>${stat.rushing_attempts || '0'}</td>
                <td>${stat.rushing_yards || '0'}</td>
                <td>${stat.rushing_tds || '0'}</td>
                <td>${stat.receptions || '0'}</td>
                <td>${stat.receiving_yards || '0'}</td>
                <td>${stat.receiving_tds || '0'}</td>
              </tr>
            `;
          });

          tableHtml += '</tbody></table>';
          statsContainer.innerHTML = tableHtml;

          // Cache the response
          cache[playerName] = tableHtml;
        } catch (error) {
          statsContainer.innerHTML = `<p class="error">Error fetching stats: ${error.message}</p>`;
        }
      });
    </script>
  </body>
</html>
